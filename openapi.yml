openapi: 3.0.0
info:
  title: ASAP API
  version: 1.0.0
servers:
  - url: http://localhost:8080

paths:
  /api/oauth2/authorization/google:
    get:
      summary: Initiate Google OAuth2 login
      operationId: initiateGoogleOAuth2
      description: Redirects the user to Google's OAuth2 authorization endpoint to initiate the login process.
      responses:
        "302":
          description: Redirect to Google OAuth2 authorization endpoint

  /api/auth/login-link:
    post:
      summary: Create login link
      operationId: createLoginLink
      tags:
        - auth
      description: Generate a login link that will be sent to the user's email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginLinkRequest"
      responses:
        "201":
          description: Login link created successfully
        "400":
          description: Invalid email format
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "429":
          description: Too many requests
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/auth/exchange:
    get:
      summary: Exchange login link token for JWT
      operationId: exchangeLoginLink
      tags:
        - auth
      description: Exchange a login link token for a JWT access token by clicking the link from email
      parameters:
        - name: organizationId
          in: query
          required: false
          schema:
            type: string
            format: uuid
          description: Optional organization ID if the login link is associated with a specific organization
        - name: token
          in: query
          required: true
          schema:
            type: string
          description: The login link token received via email
        - name: twoFactorAuthCode
          in: query
          required: false
          schema:
            type: string
      responses:
        "200":
          description: Token exchange successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthMultiResponse"
        "400":
          description: Invalid or expired token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Token not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/auth/refresh:
    post:
      summary: Refresh JWT token
      operationId: refreshToken
      tags:
        - auth
      description: Refresh an existing JWT token to extend its lifetime
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefreshTokenRequest"
      responses:
        "200":
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Invalid or expired token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/auth/login:
    post:
      summary: Login with email and password
      operationId: loginUser
      tags:
        - auth
      description: Authenticate user with email and password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthMultiResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "429":
          description: Too many requests
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/auth/forgot-password:
    post:
      summary: Request password reset
      operationId: forgotPassword
      tags:
        - auth
      description: Send password reset link to user's email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ForgotPasswordRequest"
      responses:
        "200":
          description: Password reset email sent
        "400":
          description: Invalid email format
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: User not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "429":
          description: Too many requests
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/auth/reset-password:
    post:
      summary: Reset password with token
      operationId: resetPassword
      tags:
        - auth
      description: Reset user password using reset token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ResetPasswordRequest"
      responses:
        "200":
          description: Password reset successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResetPasswordMultiResponse"
        "400":
          description: Invalid request or token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Token not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  # ========= Users =========

  /api/users/me:
    patch:
      summary: Update current user
      operationId: updateCurrentUser
      tags:
        - users
      security:
        - bearerAuth: []
      description: Update current user's profile information
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateUserRequest"
      responses:
        "200":
          description: User updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CurrentUser"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    get:
      summary: Get current user
      operationId: getCurrentUser
      tags:
        - users
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Current user details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CurrentUser"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/users/me/password:
    put:
      summary: Update current user's password
      operationId: updateCurrentUserPassword
      tags:
        - users
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdatePasswordRequest"
      responses:
        "200":
          description: Password updated successfully
        "400":
          description: Invalid request or incorrect current password
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/users/me/auth-methods:
    get:
      summary: Get current user's authentication methods configuration
      operationId: getCurrentUserAuthMethods
      tags:
        - users
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Current user's authentication methods
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserAuthMethods"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    put:
      summary: Update current user's authentication methods
      operationId: updateCurrentUserAuthMethods
      tags:
        - users
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateAuthMethodsRequest"
      responses:
        "200":
          description: Updated authentication methods
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserAuthMethods"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/users/me/email-preferences:
    get:
      summary: Get current user's email preferences
      operationId: getCurrentUserEmailPreferences
      tags:
        - users
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Current user's email preferences
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserEmailPreferences"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    put:
      summary: Update current user's email preferences
      operationId: updateCurrentUserEmailPreferences
      tags:
        - users
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
      responses:
        "200":
          description: Updated email preferences
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserEmailPreferences"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/public/users/email-preferences:
    put:
      summary: Public update of user's email preferences using token
      operationId: updatePublicUserEmailPreferences
      tags:
        - users
      description: Update a user's email preferences using a token provided in emails. Token validity is signature-based; expiration is not enforced.
      parameters:
        - name: token
          in: query
          required: true
          schema:
            type: string
          description: Signed token used to authorize updates to the user's preferences
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
      responses:
        "200":
          description: Updated email preferences
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserEmailPreferences"
        "400":
          description: Invalid request or token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    get:
      summary: Public get of user's email preferences using token
      operationId: getPublicUserEmailPreferences
      tags:
        - users
      parameters:
        - name: token
          in: query
          required: true
          schema:
            type: string
          description: Signed token used to authorize reading the user's preferences
      responses:
        "200":
          description: Current user's email preferences
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserEmailPreferences"
        "400":
          description: Invalid request or token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/admin/users:
    post:
      summary: Create user
      operationId: createAdminUser
      tags:
        - users
      security:
        - bearerAuth: []
      description: Create a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateUserRequest"
      responses:
        "200":
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    get:
      summary: Find all users
      operationId: findAdminUsers
      tags:
        - users
      security:
        - bearerAuth: []
      description: Find all users
      parameters:
        - name: query
          in: query
          required: false
          schema:
            type: string
          description: Search query
        - name: organizationId
          in: query
          required: false
          schema:
            type: string
            format: uuid
          description: Organization ID filter
        - name: organizationName
          in: query
          required: false
          schema:
            type: string
          description: Organization name filter
        - name: page
          in: query
          required: false
          schema:
            type: integer
            format: int32
          description: Page number (starts from 0)
        - name: size
          in: query
          required: false
          schema:
            type: integer
            format: int32
          description: Number of items per page
        - name: sortBy
          in: query
          required: false
          schema:
            type: string
          description: Field to sort by
        - name: order
          in: query
          required: false
          schema:
            type: string
            enum: [asc, desc]
          description: Sort order
      responses:
        "200":
          description: Users response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaginatedUserResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/admin/users/{id}:
    get:
      summary: Get user by ID
      operationId: getAdminUserById
      tags:
        - users
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: User ID
      responses:
        "200":
          description: User
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: User not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    patch:
      summary: Update user
      operationId: updateAdminUser
      tags:
        - users
      security:
        - bearerAuth: []
      description: Update a user
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: User ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateUserRequest"
      responses:
        "200":
          description: User updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: User not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    delete:
      summary: Delete user by ID
      operationId: deleteAdminUserById
      tags:
        - users
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: User ID
      responses:
        "200":
          description: User deleted successfully
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: User not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/users:
    post:
      summary: Create user
      operationId: createUser
      tags:
        - users
      security:
        - bearerAuth: []
      description: Create a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateUserRequest"
      responses:
        "200":
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    get:
      summary: Find all users
      operationId: findUsers
      tags:
        - users
      security:
        - bearerAuth: []
      description: Find all users
      parameters:
        - name: query
          in: query
          required: false
          schema:
            type: string
          description: Search query
        - name: page
          in: query
          required: false
          schema:
            type: integer
            format: int32
          description: Page number (starts from 0)
        - name: size
          in: query
          required: false
          schema:
            type: integer
            format: int32
          description: Number of items per page
        - name: sortBy
          in: query
          required: false
          schema:
            type: string
          description: Field to sort by
        - name: order
          in: query
          required: false
          schema:
            type: string
            enum: [asc, desc]
          description: Sort order
      responses:
        "200":
          description: Users response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaginatedUserResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/users/{id}:
    get:
      summary: Get user by ID
      operationId: getUserById
      tags:
        - users
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: User ID
      responses:
        "200":
          description: User
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: User not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    patch:
      summary: Update user
      operationId: updateUser
      tags:
        - users
      security:
        - bearerAuth: []
      description: Update a user
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: User ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateUserRequest"
      responses:
        "200":
          description: User updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: User not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    delete:
      summary: Delete user by ID
      operationId: deleteUserById
      tags:
        - users
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: User ID
      responses:
        "200":
          description: User deleted successfully
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: User not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  # ========= Organizations =========

  /api/organizations/switch:
    post:
      summary: Switch organization
      operationId: switchOrganization
      tags:
        - organizations
      security:
        - bearerAuth: []
      description: Switch to another organization
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SwitchOrganizationRequest"
      responses:
        "200":
          description: Switch successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "429":
          description: Too many requests
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/organizations/available:
    get:
      summary: Find all available organizations
      operationId: findAvailableOrganizations
      tags:
        - organizations
      security:
        - bearerAuth: []
      description: Find all available organizations for the current user
      parameters:
        - name: name
          in: query
          required: false
          schema:
            type: string
          description: Organization name filter
        - name: page
          in: query
          required: false
          schema:
            type: integer
            format: int32
          description: Page number (starts from 0)
        - name: size
          in: query
          required: false
          schema:
            type: integer
            format: int32
          description: Number of items per page
        - name: sortBy
          in: query
          required: false
          schema:
            type: string
          description: Field to sort by
        - name: order
          in: query
          required: false
          schema:
            type: string
            enum: [asc, desc]
          description: Sort order
      responses:
        "200":
          description: Organizations response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaginatedAvailableOrganizationResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/admin/organizations:
    post:
      summary: Create organization
      operationId: createAdminOrganization
      tags:
        - organizations
      security:
        - bearerAuth: []
      description: Create a new organization
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateOrganizationRequest"
      responses:
        "200":
          description: Organization created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Organization"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    get:
      summary: Find all organizations
      operationId: findAdminOrganizations
      tags:
        - organizations
      security:
        - bearerAuth: []
      description: Find all organizations
      parameters:
        - name: query
          in: query
          required: false
          schema:
            type: string
          description: Organization name
        - name: isActive
          in: query
          required: false
          schema:
            type: boolean
          description: Filter by active status
        - name: page
          in: query
          required: false
          schema:
            type: integer
            format: int32
          description: Page number (starts from 0)
        - name: size
          in: query
          required: false
          schema:
            type: integer
            format: int32
          description: Number of items per page
        - name: sortBy
          in: query
          required: false
          schema:
            type: string
          description: Field to sort by
        - name: order
          in: query
          required: false
          schema:
            type: string
            enum: [asc, desc]
          description: Sort order
      responses:
        "200":
          description: Organizations response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaginatedOrganizationResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/admin/organizations/{id}:
    get:
      summary: Get organization by ID
      operationId: getAdminOrganizationById
      tags:
        - organizations
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Organization ID
      responses:
        "200":
          description: Organization
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Organization"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Organization not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    patch:
      summary: Update organization
      operationId: updateAdminOrganization
      tags:
        - organizations
      security:
        - bearerAuth: []
      description: Update an organization
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Organization ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateOrganizationRequest"
      responses:
        "200":
          description: Organization updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Organization"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Organization not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    delete:
      summary: Delete organization by ID
      operationId: deleteAdminOrganizationById
      tags:
        - organizations
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Organization ID
      responses:
        "200":
          description: Organization deleted successfully
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Organization not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  # ========= Organization Members =========

  /api/organizations/{id}/members:
    get:
      summary: List organization members
      operationId: listOrganizationMembers
      tags:
        - organizations
      security:
        - bearerAuth: []
      description: List all members of an organization with pagination
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Organization ID
        - name: query
          in: query
          required: false
          schema:
            type: string
          description: Search by name or email
        - name: role
          in: query
          required: false
          schema:
            $ref: "#/components/schemas/UserRole"
          description: Filter by role
        - name: isActive
          in: query
          required: false
          schema:
            type: boolean
          description: Filter by active status
        - name: page
          in: query
          required: false
          schema:
            type: integer
            format: int32
          description: Page number (starts from 0)
        - name: size
          in: query
          required: false
          schema:
            type: integer
            format: int32
          description: Number of items per page
        - name: sortBy
          in: query
          required: false
          schema:
            type: string
          description: Field to sort by
        - name: order
          in: query
          required: false
          schema:
            type: string
            enum: [asc, desc]
          description: Sort order
      responses:
        "200":
          description: Organization members
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaginatedOrganizationMemberResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Organization not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    post:
      summary: Add organization member
      operationId: addOrganizationMember
      tags:
        - organizations
      security:
        - bearerAuth: []
      description: Add a new member to an organization by email
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Organization ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddOrganizationMemberRequest"
      responses:
        "201":
          description: Member added successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrganizationMember"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Organization not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "409":
          description: Member already exists
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/organizations/{id}/members/{memberId}:
    patch:
      summary: Update organization member role
      operationId: updateOrganizationMember
      tags:
        - organizations
      security:
        - bearerAuth: []
      description: Update a member's role or active status within an organization
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Organization ID
        - name: memberId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Member ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateOrganizationMemberRequest"
      responses:
        "200":
          description: Member updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrganizationMember"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Organization or member not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    delete:
      summary: Remove organization member
      operationId: removeOrganizationMember
      tags:
        - organizations
      security:
        - bearerAuth: []
      description: Remove a member from an organization
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Organization ID
        - name: memberId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Member ID
      responses:
        "204":
          description: Member removed successfully
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Organization or member not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # ========= Auth Schemas =========

    LoginLinkRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          description: Email address of the user to send the login link to
      required:
        - email

    RefreshTokenRequest:
      type: object
      properties:
        refreshToken:
          type: string
          description: JWT refresh token
      required:
        - refreshToken

    LoginRequest:
      type: object
      properties:
        organizationId:
          type: string
          format: uuid
          description: Organization ID to login to
        email:
          type: string
          format: email
          description: User's email address
        password:
          type: string
          description: User's password
        twoFactorAuthCode:
          type: string
      required:
        - email
        - password

    ForgotPasswordRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          description: User's email address
      required:
        - email

    AuthMultiResponse:
      oneOf:
        - $ref: "#/components/schemas/AuthResponse"
        - $ref: "#/components/schemas/AvailableOrganizationsResponse"

    ResetPasswordRequest:
      type: object
      properties:
        token:
          type: string
          description: Password reset token
        newPassword:
          type: string
          minLength: 8
          description: New password (minimum 8 characters)
      required:
        - token
        - newPassword

    AuthResponse:
      type: object
      properties:
        accessToken:
          type: string
          description: JWT access token
        refreshToken:
          type: string
          description: JWT refresh token
        twoFactorAuthToken:
          type: string
          description: Temporary token for 2FA verification (if applicable)
        twoFactorAuthRequired:
          type: boolean

    ResetPasswordResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Whether the password reset was successful

    ResetPasswordMultiResponse:
      oneOf:
        - $ref: "#/components/schemas/AvailableOrganizationsResponse"
        - $ref: "#/components/schemas/ResetPasswordResponse"

    TwoFactorSetupResponse:
      type: object
      properties:
        secret:
          type: string
          description: TOTP secret key
        qrCode:
          type: string
          description: Base64 encoded QR code image
        uri:
          type: string
          description: TOTP URI for manual setup

    TwoFactorEnableRequest:
      type: object
      properties:
        code:
          type: string
          description: TOTP code to verify setup
      required:
        - code

    TwoFactorDisableRequest:
      type: object
      properties:
        code:
          type: string
          description: TOTP code to verify disable request
      required:
        - code

    TwoFactorStatusResponse:
      type: object
      properties:
        enabled:
          type: boolean
          description: Whether 2FA is enabled

    TwoFactorVerifyRequest:
      type: object
      properties:
        organizationId:
          type: string
          format: uuid
        token:
          type: string
          description: Temporary token or OTP from initial auth
        code:
          type: string
          description: TOTP code to verify (optional for OTP flow)
      required:
        - token

    # ========= Common Schemas =========

    Error:
      type: object
      properties:
        code:
          type: integer
          description: Error code
        message:
          type: string
          description: Human-readable error message
        timestamp:
          type: string
          format: date-time
          description: Timestamp when the error occurred
        path:
          type: string
          description: Request path that caused the error

    Timestamp:
      type: string
      format: date-time
      description: Timestamp in ISO 8601 format

    PaginatedResponse:
      type: object
      properties:
        page:
          type: integer
          description: Current page number (zero-based)
        size:
          type: integer
          description: Number of items per page
        totalElements:
          type: integer
          format: int64
          description: Total number of elements
        totalPages:
          type: integer
          description: Total number of pages

    # ========= User Schemas =========

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the user
        email:
          type: string
          description: Email address of the user
        firstName:
          type: string
          description: User's first name
        lastName:
          type: string
          description: User's last name
        phone:
          type: string
          description: User's phone number
        avatarUrl:
          type: string
          format: uri
          description: URL to the user's avatar image
        roles:
          type: array
          items:
            $ref: "#/components/schemas/UserRole"
          description: User's roles
        isActive:
          type: boolean
          description: Whether the user is active
        twoFactorAuthEnabled:
          type: boolean
          description: Whether two-factor authentication is enabled
        createdAt:
          $ref: "#/components/schemas/Timestamp"
        updatedAt:
          $ref: "#/components/schemas/Timestamp"

    CurrentUser:
      allOf:
        - $ref: "#/components/schemas/User"
        - type: object
          properties:
            organizationId:
              type: string
              format: uuid
              description: The current organization ID the user is operating in

    UserRole:
      type: string
      enum:
        - PLATFORM_ADMIN
        - OWNER
        - ADMIN
        - MEMBER
        - VIEWER
        - ACCOUNTANT

    CreateUserRequest:
      type: object
      required:
        - email
        - firstName
        - roles
      properties:
        organizationId:
          type: string
          format: uuid
          description: Organization ID
        email:
          type: string
          format: email
          description: Email address of the user
        firstName:
          type: string
          description: User's first name
        lastName:
          type: string
          description: User's last name
        phone:
          type: string
          description: User's phone number
        roles:
          type: array
          items:
            $ref: "#/components/schemas/UserRole"
        sendEmail:
          type: boolean
          description: Whether to send an invitation email to the user

    UpdateUserRequest:
      type: object
      properties:
        firstName:
          type: string
          nullable: true
          description: User's first name
        lastName:
          type: string
          nullable: true
          description: User's last name
        phone:
          type: string
          nullable: true
          description: User's phone number
        avatarUrl:
          type: string
          format: uri
          nullable: true
          description: URL to the user's avatar image
        roles:
          nullable: true
          type: array
          items:
            $ref: "#/components/schemas/UserRole"
          description: User's roles
      description: Request to update user profile information

    UpdatePasswordRequest:
      type: object
      properties:
        oldPassword:
          type: string
          description: Current password
        newPassword:
          type: string
          description: New password
        twoFactorAuthCode:
          type: string
          description: 2FA code (if applicable)

    UserAuthMethods:
      type: object
      properties:
        passwordEnabled:
          type: boolean
          description: Whether password authentication is enabled
        loginLinkEnabled:
          type: boolean
          description: Whether login link authentication is enabled
        googleEnabled:
          type: boolean
          description: Whether Google OAuth authentication is enabled

    UpdateAuthMethodsRequest:
      type: object
      properties:
        passwordEnabled:
          type: boolean
          description: Enable or disable password authentication
        loginLinkEnabled:
          type: boolean
          description: Enable or disable login link authentication
        googleEnabled:
          type: boolean
          description: Enable or disable Google OAuth authentication
        twoFactorAuthCode:
          type: string
          description: 2FA code (required if 2FA is active)

    UserEmailPreferences:
      type: object
      properties:
        email:
          type: string
          format: email
          description: User's email address
        preferences:
          type: object
          additionalProperties: true

    PaginatedUserResponse:
      allOf:
        - $ref: "#/components/schemas/PaginatedResponse"
        - type: object
          properties:
            items:
              type: array
              items:
                $ref: "#/components/schemas/User"
              description: List of users

    # ========= Organization Schemas =========

    Organization:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Organization ID
        name:
          type: string
          description: Organization name
        slug:
          type: string
          description: URL-friendly identifier for the organization
        isActive:
          type: boolean
          description: Whether the organization is active
        settings:
          type: object
          additionalProperties: true
          description: Organization-level settings
        billingInfo:
          type: object
          additionalProperties: true
          description: Organization billing information
        createdAt:
          $ref: "#/components/schemas/Timestamp"
        updatedAt:
          $ref: "#/components/schemas/Timestamp"

    AvailableOrganizationResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Organization ID
        name:
          type: string
          description: Organization name

    AvailableOrganizationsResponse:
      type: object
      properties:
        organizations:
          type: array
          items:
            $ref: "#/components/schemas/AvailableOrganizationResponse"
          description: List of available organizations for the user

    SwitchOrganizationRequest:
      type: object
      properties:
        organizationId:
          type: string
          format: uuid
          description: Organization ID to switch to

    CreateOrganizationRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: Organization name
        slug:
          type: string
          description: URL-friendly identifier for the organization

    UpdateOrganizationRequest:
      type: object
      properties:
        name:
          nullable: true
          type: string
          description: Organization name
        slug:
          nullable: true
          type: string
          description: URL-friendly identifier for the organization
        isActive:
          nullable: true
          type: boolean
          description: Whether the organization is active
        settings:
          nullable: true
          type: object
          additionalProperties: true
          description: Organization-level settings
        billingInfo:
          nullable: true
          type: object
          additionalProperties: true
          description: Organization billing information

    PaginatedOrganizationResponse:
      allOf:
        - $ref: "#/components/schemas/PaginatedResponse"
        - type: object
          properties:
            items:
              type: array
              items:
                $ref: "#/components/schemas/Organization"
              description: List of organizations

    PaginatedAvailableOrganizationResponse:
      allOf:
        - $ref: "#/components/schemas/PaginatedResponse"
        - type: object
          properties:
            items:
              type: array
              items:
                $ref: "#/components/schemas/AvailableOrganizationResponse"
              description: List of available organizations for the user

    # ========= Organization Member Schemas =========

    OrganizationMember:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Membership ID
        organizationId:
          type: string
          format: uuid
          description: Organization ID
        userId:
          type: string
          format: uuid
          description: User ID
        userEmail:
          type: string
          description: User's email address
        userFirstName:
          type: string
          description: User's first name
        userLastName:
          type: string
          description: User's last name
        role:
          $ref: "#/components/schemas/UserRole"
        isActive:
          type: boolean
          description: Whether the membership is active
        joinedAt:
          type: string
          format: date-time
          description: Timestamp when the member joined
        invitedAt:
          type: string
          format: date-time
          description: Timestamp when the member was invited

    AddOrganizationMemberRequest:
      type: object
      required:
        - email
        - role
      properties:
        email:
          type: string
          format: email
          description: Email address of the user to add
        role:
          $ref: "#/components/schemas/UserRole"

    UpdateOrganizationMemberRequest:
      type: object
      properties:
        role:
          $ref: "#/components/schemas/UserRole"
        isActive:
          type: boolean
          description: Whether the membership is active

    PaginatedOrganizationMemberResponse:
      allOf:
        - $ref: "#/components/schemas/PaginatedResponse"
        - type: object
          properties:
            items:
              type: array
              items:
                $ref: "#/components/schemas/OrganizationMember"
              description: List of organization members
